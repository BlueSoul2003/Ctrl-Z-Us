import{r as o,l as N,n as I,a as b,j as s,o as w,q as S}from"./index-yWr8wzxB.js";import{F as M}from"./FloatingAiChatbot-DdYjnADj.js";function D({user:a}){const[t,h]=o.useState("groups"),[l,m]=o.useState(null),[x,f]=o.useState(""),c=o.useMemo(()=>N.filter(e=>e.members.includes(a.id)),[a.id]),g=o.useMemo(()=>{const e=I.filter(i=>i.senderId===a.id||i.receiverId===a.id),r=new Map;return e.forEach(i=>{const u=i.senderId===a.id?i.receiverId:i.senderId;r.has(u)||r.set(u,[]),r.get(u).push(i)}),Array.from(r.entries()).map(([i,u])=>({otherId:i,items:u.sort((v,j)=>new Date(v.timestamp)-new Date(j.timestamp))}))},[a.id]);o.useEffect(()=>{l||(t==="groups"&&c.length&&m(c[0].id),t==="private"&&g.length&&m(g[0].otherId))},[t,c,g,l]);const d=t==="groups"?c.find(e=>e.id===l):null,n=t==="private"?g.find(e=>e.otherId===l):null,p=n?b.find(e=>e.id===n.otherId):null,y=e=>{e.preventDefault();const r=x.trim();r&&(t==="groups"&&d?w(d.id,{senderId:a.id,text:r}):t==="private"&&p&&S({senderId:a.id,receiverId:p.id,text:r,senderName:a.name,receiverName:p.name}),f(""))};return s.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-12",children:[s.jsxs("aside",{className:"lg:col-span-4 rounded-lg border border-gray-200 bg-white p-4 shadow-sm","aria-label":"Chat list",children:[s.jsxs("div",{className:"flex items-center gap-2",role:"tablist","aria-label":"Messages type",children:[s.jsx("button",{role:"tab","aria-selected":t==="groups",className:`rounded-md px-3 py-2 text-sm font-semibold focus:outline-none focus:ring-2 focus:ring-blue-500 ${t==="groups"?"bg-blue-600 text-white":"text-gray-700 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"}`,onClick:()=>h("groups"),children:"Discussion Groups"}),s.jsx("button",{role:"tab","aria-selected":t==="private",className:`rounded-md px-3 py-2 text-sm font-semibold focus:outline-none focus:ring-2 focus:ring-blue-500 ${t==="private"?"bg-blue-600 text-white":"text-gray-700 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"}`,onClick:()=>h("private"),children:"Private Messages"})]}),s.jsxs("ul",{role:"list",className:"mt-4 space-y-2 max-h-[65vh] overflow-y-auto",children:[t==="groups"&&c.map(e=>s.jsx("li",{children:s.jsxs("button",{onClick:()=>m(e.id),className:`w-full rounded-md px-3 py-2 text-left text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${l===e.id?"bg-blue-50 text-blue-900":"hover:bg-gray-50"}`,children:[s.jsx("div",{className:"font-medium text-gray-900",children:e.name}),s.jsx("div",{className:"text-xs text-gray-600 line-clamp-1",children:e.messages[e.messages.length-1]?.text||"No messages"})]})},e.id)),t==="private"&&g.map(e=>s.jsx("li",{children:s.jsxs("button",{onClick:()=>m(e.otherId),className:`w-full rounded-md px-3 py-2 text-left text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${l===e.otherId?"bg-blue-50 text-blue-900":"hover:bg-gray-50"}`,children:[s.jsx("div",{className:"font-medium text-gray-900",children:b.find(r=>r.id===e.otherId)?.name||"Thread"}),s.jsx("div",{className:"text-xs text-gray-600 line-clamp-1",children:e.items[e.items.length-1]?.text||"No messages"})]})},e.otherId))]})]}),s.jsxs("section",{className:"lg:col-span-8 grid grid-rows-[1fr_auto] rounded-lg border border-gray-200 bg-white shadow-sm","aria-label":"Chat window",children:[s.jsxs("div",{className:"max-h-[70vh] overflow-y-auto p-4","aria-live":"polite",children:[t==="groups"&&d&&s.jsx("ul",{role:"list",className:"space-y-3",children:d.messages.map(e=>s.jsx("li",{className:`flex ${e.senderId===a.id?"justify-end":"justify-start"}`,children:s.jsx("div",{className:`rounded-md px-3 py-2 text-sm ${e.senderId===a.id?"bg-blue-600 text-white ml-auto":"bg-gray-100 text-gray-900"}`,children:e.text})},e.id))}),t==="private"&&n&&s.jsx("ul",{role:"list",className:"space-y-3",children:n.items.map(e=>s.jsx("li",{className:`flex ${e.senderId===a.id?"justify-end":"justify-start"}`,children:s.jsx("div",{className:`rounded-md px-3 py-2 text-sm ${e.senderId===a.id?"bg-blue-600 text-white ml-auto":"bg-gray-100 text-gray-900"}`,children:e.text})},e.id))}),!d&&t==="groups"&&s.jsx("p",{className:"text-sm text-gray-600",children:"Select a group on the left to start chatting."}),!n&&t==="private"&&s.jsx("p",{className:"text-sm text-gray-600",children:"Select a thread on the left to start chatting."})]}),s.jsxs("form",{className:"flex items-center gap-2 border-t border-gray-200 p-3",onSubmit:y,"aria-label":"Send message",children:[s.jsx("label",{htmlFor:"msg-input",className:"sr-only",children:"Type a message"}),s.jsx("input",{id:"msg-input",type:"text",value:x,onChange:e=>f(e.target.value),placeholder:"Type a message...",className:"flex-1 rounded-md border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"}),s.jsx("button",{type:"submit",className:"rounded-md bg-blue-600 px-4 py-2 text-sm font-semibold text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",disabled:!x.trim()||!d&&!n,"aria-label":"Send",children:"Send"})]})]}),s.jsx(M,{user:a})]})}export{D as default};
