import{r as i,n,a as v,j as e,q as N}from"./index-yWr8wzxB.js";import{S as w}from"./StudentProfileModal-Bg3rBU4T.js";function M({user:r}){const[a,m]=i.useState(null),[l,c]=i.useState(""),[g,o]=i.useState(!1),[u,x]=i.useState(null),h=i.useMemo(()=>{const s=[...new Set(n.filter(t=>t.receiverId===r.id).map(t=>t.senderId))];return v.filter(t=>s.includes(t.id))},[r.id]),p=i.useMemo(()=>a?n.filter(s=>s.senderId===r.id&&s.receiverId===a.id||s.senderId===a.id&&s.receiverId===r.id).sort((s,t)=>new Date(s.timestamp)-new Date(t.timestamp)):[],[a,r.id]),f=s=>{if(s.preventDefault(),!l.trim()||!a)return;const t={senderId:r.id,receiverId:a.id,text:l.trim(),senderName:r.name,receiverName:a.name};N(t),c("")},b=s=>new Date(s).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),j=(s,t)=>{t.stopPropagation(),x(s),o(!0)};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("header",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Messages"}),e.jsx("p",{className:"text-gray-600",children:"Communicate with your students."})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-200",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Students"})}),e.jsx("div",{className:"divide-y divide-gray-200",children:h.map(s=>{const t=n.filter(d=>d.senderId===r.id&&d.receiverId===s.id||d.senderId===s.id&&d.receiverId===r.id).sort((d,y)=>new Date(y.timestamp)-new Date(d.timestamp))[0];return e.jsx("button",{onClick:()=>m(s),className:`w-full px-4 py-3 text-left hover:bg-gray-50 focus:outline-none focus:bg-gray-50 ${a?.id===s.id?"bg-blue-50":""}`,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:d=>j(s.id,d),className:"hover:opacity-80 transition-opacity",title:"View student profile",children:e.jsx("img",{src:s.avatarUrl,alt:`${s.name} avatar`,className:"h-10 w-10 rounded-full ring-1 ring-gray-300 hover:ring-2 hover:ring-blue-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:s.name}),t&&e.jsxs("p",{className:"text-xs text-gray-500 truncate",children:[t.senderId===r.id?"You: ":"",t.text]})]})]})},s.id)})})]})}),e.jsx("div",{className:"lg:col-span-2",children:a?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 flex flex-col h-96",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("img",{src:a.avatarUrl,alt:`${a.name} avatar`,className:"h-8 w-8 rounded-full ring-1 ring-gray-300"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:a.name}),e.jsx("p",{className:"text-xs text-gray-500",children:"Student"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:p.map(s=>e.jsx("div",{className:`flex ${s.senderId===r.id?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${s.senderId===r.id?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"}`,children:[e.jsx("p",{className:"text-sm",children:s.text}),e.jsx("p",{className:`text-xs mt-1 ${s.senderId===r.id?"text-blue-100":"text-gray-500"}`,children:b(s.timestamp)})]})},s.id))}),e.jsx("form",{onSubmit:f,className:"p-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:l,onChange:s=>c(s.target.value),placeholder:"Type a message...",className:"flex-1 rounded-md border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{type:"submit",disabled:!l.trim(),className:"rounded-md bg-blue-600 px-4 py-2 text-sm font-semibold text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Send"})]})})]}):e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 h-96 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-gray-500",children:"Select a student to start messaging"})})})})]}),e.jsx(w,{studentId:u,open:g,onClose:()=>{o(!1),x(null)}})]})}export{M as default};
